<!-- Get 5 last posted/updated posts -->

{% assign MAX_SIZE = 5 %}

{%- comment -%}
  1) 현재 언어(include.lang)에 해당하는 포스트만 모은다.
     - 모든 포스트 front matter에 lang 값이 있어야 제대로 동작.
     - 예: lang: en, lang: ko-KR, lang: ja-JP
{%- endcomment -%}
{% assign filtered_posts = site.posts | where: "lang", include.lang %}

{%- comment -%}
  혹시 lang 없는 옛날 포스트까지 EN에 포함시키고 싶다면,
  여기서 조건 추가해서 머지하는 것도 가능.
{%- endcomment -%}

{% assign all_list = '' | split: '' %}

{%- comment -%}
  2) 언어별로 필터된 포스트들만 대상으로
     last_modified_at(or date) 기준으로 정렬하기 위한 키 생성
{%- endcomment -%}
{% for post in filtered_posts %}
  {% assign datetime = post.last_modified_at | default: post.date %}

  {% capture elem %}
    {{- datetime | date: "%Y%m%d%H%M%S" -}}::{{- forloop.index0 -}}
  {% endcapture %}

  {% assign all_list = all_list | push: elem %}
{% endfor %}

{% assign all_list = all_list | sort | reverse %}

{% assign update_list = '' | split: '' %}

{% for entry in all_list limit: MAX_SIZE %}
  {% assign update_list = update_list | push: entry %}
{% endfor %}

{% if update_list.size > 0 %}
  <section id="access-lastmod">
    <h2 class="panel-heading">{{- site.data.locales[include.lang].panel.lastmod -}}</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      {% for item in update_list %}
        {% assign index = item | split: '::' | last | plus: 0 %}

        {%- comment -%}
          3) 여기서도 site.posts가 아니라 filtered_posts에서 뽑아야 함
        {%- endcomment -%}
        {% assign post = filtered_posts[index] %}
        {% assign url = post.url | relative_url %}

        <li class="text-truncate lh-lg">
          <a href="{{ url }}">{{ post.title }}</a>
        </li>
      {% endfor %}
    </ul>
  </section>
  <!-- #access-lastmod -->
{% endif %}
